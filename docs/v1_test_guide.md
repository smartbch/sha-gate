# smartBCH SHA-Gate Testing Guide



## Step#0: prepare

Clone and prepare shagate repo:

```bash
$ npm install -g ts-node
$ npm install -g cashc

$ git clone https://github.com/smartbch/shagate.git
$ cd shagate
$ npm install
```

Open cc_covenant_v1_testnet.ts, change rootSeet's mnemonic words to get a set of clean testing accounts:

```typescript
...
const rootSeed = bitbox.Mnemonic.toSeed('cc_covenant_v1_testnet_xxx');
...
```

Note, for testing purpose, the covenant was modified in following places:

* for voting, coinbase tx check is disabled

```typescript
//require(hash160(coinbaseTx.split(4)[1].split(37)[0]) == 0x282711cb97968c8674a46b5564ce3549f5782ea4);
require(hash160(coinbaseTx.split(4)[1].split(37)[0]) != 0x282711cb97968c8674a46b5564ce3549f5782ea4);
```

* for finish unlock, waiting time is shortened

```typescript
//require(tx.age >= 150);
require(tx.age >= 2);
```



## Step#1: deposit some BCH

Show contract  address to deposit:

```bash
$ ts-node cc_covenant_v1_testnet.ts printCCDepositInfo

op0Pkh: 1adb432851cee81f2be81c0d6f4d8a3adb097a8a
op1Pkh: b43abfe1807134ff03c2ee9a70153fd9b7a187f7
op2Pkh: 5c033dea9bfe166b6d12dff978ef3681d90d0517
>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: 0000000000000000000000000000000000000000
2) yesNoBytes : 00000000
contract address: bchtest:pq33fgy5ldt357jmlm0rujd3h4u2uq759c4h048v9x
contract balance: 0
contract UTXOs  : []
```

Send some BCH to above address (e.g. 20000satoshi):

```bash
$ ts-node p2pkh.ts bchtest:pq33fgy5ldt357jmlm0rujd3h4u2uq759c4h048v9x 20000
```

Now our contract has one UTXO:

```bash
$ ts-node cc_covenant_v1_testnet.ts printCCDepositInfo

op0Pkh: 1adb432851cee81f2be81c0d6f4d8a3adb097a8a
op1Pkh: b43abfe1807134ff03c2ee9a70153fd9b7a187f7
op2Pkh: 5c033dea9bfe166b6d12dff978ef3681d90d0517
>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: 0000000000000000000000000000000000000000
2) yesNoBytes : 00000000
contract address: bchtest:pq33fgy5ldt357jmlm0rujd3h4u2uq759c4h048v9x
contract balance: 20000
contract UTXOs  : [
  {
    txid: '52c9553a30e7353616014547f51a6edf48e16095369f54d6f0223d619f62c233',
    vout: 0,
    satoshis: 20000,
    height: 1460822
  }
]
```

The UTXO that hold the value is '52c9553a30e7353616014547f51a6edf48e16095369f54d6f0223d619f62c233:0', we will unlock it soon.



## Step#2: init unlock

Lets see who is Alice:

```bash
$ ts-node cc_covenant_v1_testnet.ts printAliceInfo

cash addr: bitcoincash:qrj88axzrl4gy32whzdknzagfs4w85rg4qvpe3ph4t
utxos: []
```

Her unlocking contract address is:

```bash
$ ts-node cc_covenant_v1_testnet.ts printCCUnlockInfo alice

>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: e473f4c21fea82454eb89b698ba84c2ae3d068a8
2) yesNoBytes : 00000000
contract address: bchtest:ppxffmr6zuftjxcewcsuplmq32e2y5ej7cfqjku5u7
contract balance: 0
contract UTXOs  : []
```

Let operator0 init unlock for Alice:

```bash
$ ts-node cc_covenant_v1_testnet.ts initUnlock alice 52c9553a30e7353616014547f51a6edf48e16095369f54d6f0223d619f62c233:0

>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: 0000000000000000000000000000000000000000
2) yesNoBytes : 00000000
fromContract address: bchtest:pq33fgy5ldt357jmlm0rujd3h4u2uq759c4h048v9x
fromContract balance: 20000

>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: e473f4c21fea82454eb89b698ba84c2ae3d068a8
2) yesNoBytes : 00000000
toContract address  : bchtest:ppxffmr6zuftjxcewcsuplmq32e2y5ej7cfqjku5u7
toContract balance  : 0
fromContract UTXOs  : [
  {
    txid: '52c9553a30e7353616014547f51a6edf48e16095369f54d6f0223d619f62c233',
    vout: 0,
    satoshis: 20000,
    height: 1460822
  }
]

transaction details: {
  "inputs": [
    {
      "outpointIndex": 0,
      "outpointTransactionHash": "<Uint8Array: 0x52c9553a30e7353616014547f51a6edf48e16095369f54d6f0223d619f62c233>",
      "sequenceNumber": 4294967294,
      "unlockingBytecode": "<Uint8Array: 0x000000040000000000145c033dea9bfe166b6d12dff978ef3681d90d051714b43abfe1807134ff03c2ee9a70153fd9b7a187f7141adb432851cee81f2be81c0d6f4d8a3adb097a8a14e473f4c21fea82454eb89b698ba84c2ae3d068a8210299a89d62866636c54e008b422bacacea5e0a6dab21324c7213c4932b189c6dd041259d341401bfef7805ea4994f27f5399b1413b4b14aacd4f8014c837fdde67aed153d894d089d11bb0ae684cf3e79de573c1405ba8292f34b412a9bdaaf33813414de80102000000f632e2c86737e52de19ee9b45420fe5cfa8419ea2e63d11479dacd4f5e12046e18606b350cd8bf565266bc352f0caddcf01e8fa789dd8a15386327cf8cabe19833c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c95200000000fd49010400000000140000000000000000000000000000000000000000140b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a5379547f7701207f01207f7701247f537f77820134947f587f547f7701207f75597a5a796e7c828c7f755c7aa87bbbad060400000000145a7a7e5379011a7f777e587a8101117a635979a9597988029600b2757603e09304967802307597a269675f79009c635979a95b795d797e5e797ea9597988765c7987785e79879b785f79879b697803e09304965279023075979f63022c01b2756875675d79547f7701257f75a914282711cb97968c8674a46b5564ce3549f5782ea487916955795e79aa7e5f797eaa5779885d7960797f7701247f7556798860796376023075937767768b7768547854807e5579557f777e7b757c6853798102b80b945880760317a9147e5379a97e01877e76aa5579886d686d6d6d6d6d6d6d6d7551204e000000000000feffffff7aff90ede7d9f7b227531b98199d0ce256cf3e732a0e454c5e16430e80092c5f584a1600410000004d49010400000000140000000000000000000000000000000000000000140b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a5379547f7701207f01207f7701247f537f77820134947f587f547f7701207f75597a5a796e7c828c7f755c7aa87bbbad060400000000145a7a7e5379011a7f777e587a8101117a635979a9597988029600b2757603e09304967802307597a269675f79009c635979a95b795d797e5e797ea9597988765c7987785e79879b785f79879b697803e09304965279023075979f63022c01b2756875675d79547f7701257f75a914282711cb97968c8674a46b5564ce3549f5782ea487916955795e79aa7e5f797eaa5779885d7960797f7701247f7556798860796376023075937767768b7768547854807e5579557f777e7b757c6853798102b80b945880760317a9147e5379a97e01877e76aa5579886d686d6d6d6d6d6d6d6d7551>"
    }
  ],
  "locktime": 1460824,
  "outputs": [
    {
      "lockingBytecode": "<Uint8Array: 0xa9144c94ec7a1712b91b197621c0ff608ab2a25332f687>",
      "satoshis": "<Uint8Array: 0x6842000000000000>"
    }
  ],
  "version": 2,
  "txid": "e02813b6543c0209a8a1f5875252b3081d5aa74a1a20aa37ac9dc78576ec33e3",
  "hex": "020000000133c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c95200000000fdf803000000040000000000145c033dea9bfe166b6d12dff978ef3681d90d051714b43abfe1807134ff03c2ee9a70153fd9b7a187f7141adb432851cee81f2be81c0d6f4d8a3adb097a8a14e473f4c21fea82454eb89b698ba84c2ae3d068a8210299a89d62866636c54e008b422bacacea5e0a6dab21324c7213c4932b189c6dd041259d341401bfef7805ea4994f27f5399b1413b4b14aacd4f8014c837fdde67aed153d894d089d11bb0ae684cf3e79de573c1405ba8292f34b412a9bdaaf33813414de80102000000f632e2c86737e52de19ee9b45420fe5cfa8419ea2e63d11479dacd4f5e12046e18606b350cd8bf565266bc352f0caddcf01e8fa789dd8a15386327cf8cabe19833c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c95200000000fd49010400000000140000000000000000000000000000000000000000140b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a5379547f7701207f01207f7701247f537f77820134947f587f547f7701207f75597a5a796e7c828c7f755c7aa87bbbad060400000000145a7a7e5379011a7f777e587a8101117a635979a9597988029600b2757603e09304967802307597a269675f79009c635979a95b795d797e5e797ea9597988765c7987785e79879b785f79879b697803e09304965279023075979f63022c01b2756875675d79547f7701257f75a914282711cb97968c8674a46b5564ce3549f5782ea487916955795e79aa7e5f797eaa5779885d7960797f7701247f7556798860796376023075937767768b7768547854807e5579557f777e7b757c6853798102b80b945880760317a9147e5379a97e01877e76aa5579886d686d6d6d6d6d6d6d6d7551204e000000000000feffffff7aff90ede7d9f7b227531b98199d0ce256cf3e732a0e454c5e16430e80092c5f584a1600410000004d49010400000000140000000000000000000000000000000000000000140b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a5379547f7701207f01207f7701247f537f77820134947f587f547f7701207f75597a5a796e7c828c7f755c7aa87bbbad060400000000145a7a7e5379011a7f777e587a8101117a635979a9597988029600b2757603e09304967802307597a269675f79009c635979a95b795d797e5e797ea9597988765c7987785e79879b785f79879b697803e09304965279023075979f63022c01b2756875675d79547f7701257f75a914282711cb97968c8674a46b5564ce3549f5782ea487916955795e79aa7e5f797eaa5779885d7960797f7701247f7556798860796376023075937767768b7768547854807e5579557f777e7b757c6853798102b80b945880760317a9147e5379a97e01877e76aa5579886d686d6d6d6d6d6d6d6d7551feffffff01684200000000000017a9144c94ec7a1712b91b197621c0ff608ab2a25332f687584a1600"
}
```

Now the unlocking is waiting to be voted:

```bash
$ ts-node cc_covenant_v1_testnet.ts printCCVoteInfo alice 0 0
 
>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: e473f4c21fea82454eb89b698ba84c2ae3d068a8
2) yesNoBytes : 00000000
contract address: bchtest:ppxffmr6zuftjxcewcsuplmq32e2y5ej7cfqjku5u7
contract balance: 17000
contract UTXOs  : [
  {
    txid: 'e02813b6543c0209a8a1f5875252b3081d5aa74a1a20aa37ac9dc78576ec33e3',
    vout: 0,
    satoshis: 17000,
    height: 1460825
  }
]
```

Now, the UTXO that hold the value (3000 is used as tx fee) is 'e02813b6543c0209a8a1f5875252b3081d5aa74a1a20aa37ac9dc78576ec33e3:0'.



## Step#3: miner0 want to vote

Let miner0 vote Yes for above unlock, his address is:

```bash
$ ts-node cc_covenant_v1_testnet.ts printMinerInfo

cash addr: bitcoincash:qp8tqf6v0hvcz94sq6h6qpvnhu3kud7j8urd6xc59f
utxos: []
```

Give him a fake coinbase UTXO:

```bash
$ ts-node cc_covenant_v1_testnet.ts printOutpointOpRetData e02813b6543c0209a8a1f5875252b3081d5aa74a1a20aa37ac9dc78576ec33e3 0
e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000

$ ts-node p2pkh.ts bitcoincash:qp8tqf6v0hvcz94sq6h6qpvnhu3kud7j8urd6xc59f 1000 \
	0xe333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000
```

transaction details:

```json
transaction details: {
  "inputs": [
    {
      "outpointIndex": 1,
      "outpointTransactionHash": "<Uint8Array: 0x52c9553a30e7353616014547f51a6edf48e16095369f54d6f0223d619f62c233>",
      "sequenceNumber": 4294967294,
      "unlockingBytecode": "<Uint8Array: 0x41724009d0dd3d502def7e346eff213a0be2a89acd9740cc11535d813626b081e6bf431fa7a2d2b0aa7735858577702168593940bef4ad4b975e3673a304bc4a2841210380690473f0f8dcd6f3196e044d4fc160c44597315ccd6a42117f1d6f56cc960819143ed2b14d2418fdf1b384abbf9bbe4a9b9524ca6178a988ac>"
    }
  ],
  "locktime": 1460826,
  "outputs": [
    {
      "lockingBytecode": "<Uint8Array: 0x76a9144eb0274c7dd98116b006afa00593bf236e37d23f88ac>",
      "satoshis": "<Uint8Array: 0xe803000000000000>"
    },
    {
      "lockingBytecode": "<Uint8Array: 0x6a24e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000>",
      "satoshis": "<Uint8Array: 0x0000000000000000>"
    },
    {
      "lockingBytecode": "<Uint8Array: 0xa91483eb112ad5945d4463cd4a8cd4881fcad8478c7e87>",
      "satoshis": "<Uint8Array: 0xe21c270400000000>"
    }
  ],
  "version": 2,
  "txid": "12e0043a4157c25014b058cd738b01684166d4d8156cbdb4647ef962fc6ddae9",
  "hex": "020000000133c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c952010000007e41724009d0dd3d502def7e346eff213a0be2a89acd9740cc11535d813626b081e6bf431fa7a2d2b0aa7735858577702168593940bef4ad4b975e3673a304bc4a2841210380690473f0f8dcd6f3196e044d4fc160c44597315ccd6a42117f1d6f56cc960819143ed2b14d2418fdf1b384abbf9bbe4a9b9524ca6178a988acfeffffff03e8030000000000001976a9144eb0274c7dd98116b006afa00593bf236e37d23f88ac0000000000000000266a24e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000e21c27040000000017a91483eb112ad5945d4463cd4a8cd4881fcad8478c7e875a4a1600"
}
```

Let see miner0 again:

```bash
$ ts-node cc_covenant_v1_testnet.ts printMinerInfo

cash addr: bitcoincash:qp8tqf6v0hvcz94sq6h6qpvnhu3kud7j8urd6xc59f
utxos: [
  {
    txid: '12e0043a4157c25014b058cd738b01684166d4d8156cbdb4647ef962fc6ddae9',
    vout: 0,
    satoshis: 1000,
    height: 0
  }
]
```

We need txid and vout, which is:

```
12e0043a4157c25014b058cd738b01684166d4d8156cbdb4647ef962fc6ddae9:0
```

and raw tx, which is:

```
020000000133c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c952010000007e41724009d0dd3d502def7e346eff213a0be2a89acd9740cc11535d813626b081e6bf431fa7a2d2b0aa7735858577702168593940bef4ad4b975e3673a304bc4a2841210380690473f0f8dcd6f3196e044d4fc160c44597315ccd6a42117f1d6f56cc960819143ed2b14d2418fdf1b384abbf9bbe4a9b9524ca6178a988acfeffffff03e8030000000000001976a9144eb0274c7dd98116b006afa00593bf236e37d23f88ac0000000000000000266a24e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000e21c27040000000017a91483eb112ad5945d4463cd4a8cd4881fcad8478c7e875a4a1600
```

and the index of 'e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000', which is: 218.



## Step#4: miner0 vote Yes

Now miner0 is ready to vote Yes:

```bash
$ ts-node cc_covenant_v1_testnet.ts vote \
  --receiverPkHex alice \
  --oldYes 0 \
  --oldNo 0 \
  --agreed true \
  --votingUtxo   e02813b6543c0209a8a1f5875252b3081d5aa74a1a20aa37ac9dc78576ec33e3:0 \
  --coinbaseUtxo 12e0043a4157c25014b058cd738b01684166d4d8156cbdb4647ef962fc6ddae9:0 \
  --cbRawTx 020000000133c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c952010000007e41724009d0dd3d502def7e346eff213a0be2a89acd9740cc11535d813626b081e6bf431fa7a2d2b0aa7735858577702168593940bef4ad4b975e3673a304bc4a2841210380690473f0f8dcd6f3196e044d4fc160c44597315ccd6a42117f1d6f56cc960819143ed2b14d2418fdf1b384abbf9bbe4a9b9524ca6178a988acfeffffff03e8030000000000001976a9144eb0274c7dd98116b006afa00593bf236e37d23f88ac0000000000000000266a24e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000e21c27040000000017a91483eb112ad5945d4463cd4a8cd4881fcad8478c7e875a4a1600 \
  --cbVout 0 \
  --opRetPos 218
```

long output:

```
vote...
receiverPk  : 02927c8ef20975fdf99e302ace7563fb416e6471cd8a3869bcb328692d2148d3a0
oldYes      : 0
oldNo       : 0
agreed      : true
votingUtxo: e02813b6543c0209a8a1f5875252b3081d5aa74a1a20aa37ac9dc78576ec33e3:0
coinbaseUtxo: 12e0043a4157c25014b058cd738b01684166d4d8156cbdb4647ef962fc6ddae9:0
cbRawTx     : 020000000133c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c952010000007e41724009d0dd3d502def7e346eff213a0be2a89acd9740cc11535d813626b081e6bf431fa7a2d2b0aa7735858577702168593940bef4ad4b975e3673a304bc4a2841210380690473f0f8dcd6f3196e044d4fc160c44597315ccd6a42117f1d6f56cc960819143ed2b14d2418fdf1b384abbf9bbe4a9b9524ca6178a988acfeffffff03e8030000000000001976a9144eb0274c7dd98116b006afa00593bf236e37d23f88ac0000000000000000266a24e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000e21c27040000000017a91483eb112ad5945d4463cd4a8cd4881fcad8478c7e875a4a1600
cbVout      : 0
opRetPos    : 218
>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: e473f4c21fea82454eb89b698ba84c2ae3d068a8
2) yesNoBytes : 00000000
>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: e473f4c21fea82454eb89b698ba84c2ae3d068a8
2) yesNoBytes : 30750000
fromContract UTXOs  : [
  {
    txid: 'e02813b6543c0209a8a1f5875252b3081d5aa74a1a20aa37ac9dc78576ec33e3',
    vout: 0,
    satoshis: 17000,
    height: 1460825
  }
]
miner UTXOs  : [
  {
    txid: '12e0043a4157c25014b058cd738b01684166d4d8156cbdb4647ef962fc6ddae9',
    vout: 0,
    satoshis: 1000,
    height: 0
  }
]
transaction details: {
  "inputs": [
    {
      "outpointIndex": 0,
      "outpointTransactionHash": "<Uint8Array: 0xe02813b6543c0209a8a1f5875252b3081d5aa74a1a20aa37ac9dc78576ec33e3>",
      "sequenceNumber": 4294967294,
      "unlockingBytecode": "<Uint8Array: 0x005102da0004000000004d2201020000000133c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c952010000007e41724009d0dd3d502def7e346eff213a0be2a89acd9740cc11535d813626b081e6bf431fa7a2d2b0aa7735858577702168593940bef4ad4b975e3673a304bc4a2841210380690473f0f8dcd6f3196e044d4fc160c44597315ccd6a42117f1d6f56cc960819143ed2b14d2418fdf1b384abbf9bbe4a9b9524ca6178a988acfeffffff03e8030000000000001976a9144eb0274c7dd98116b006afa00593bf236e37d23f88ac0000000000000000266a24e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000e21c27040000000017a91483eb112ad5945d4463cd4a8cd4881fcad8478c7e875a4a1600145c033dea9bfe166b6d12dff978ef3681d90d051714b43abfe1807134ff03c2ee9a70153fd9b7a187f7141adb432851cee81f2be81c0d6f4d8a3adb097a8a14e473f4c21fea82454eb89b698ba84c2ae3d068a82103bf09ffac54d36172478e515e51c50df133e42d4879361f91574b36163a71d0ec41b996b989403c2d12a8fff44dd0d9f6d041225e8c84d9ed5db0d170029ed0b8ce9b11c2a997abeaad0ce517cb0cb59195073e64999557be4766e2b35cdf07c490414de80102000000ab6d4b4c6a52752e26e4a8c53bf31d5f98a7ec04c9859d7a6c9a6cbd1166e11ac992651ac89a97aecd0811c1761915a8e2c8f5153d1bdd994a789e6bd86ab717e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000fd4901040000000014e473f4c21fea82454eb89b698ba84c2ae3d068a8140b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a5379547f7701207f01207f7701247f537f77820134947f587f547f7701207f75597a5a796e7c828c7f755c7aa87bbbad060400000000145a7a7e5379011a7f777e587a8101117a635979a9597988029600b2757603e09304967802307597a269675f79009c635979a95b795d797e5e797ea9597988765c7987785e79879b785f79879b697803e09304965279023075979f63022c01b2756875675d79547f7701257f75a914282711cb97968c8674a46b5564ce3549f5782ea487916955795e79aa7e5f797eaa5779885d7960797f7701247f7556798860796376023075937767768b7768547854807e5579557f777e7b757c6853798102b80b945880760317a9147e5379a97e01877e76aa5579886d686d6d6d6d6d6d6d6d75516842000000000000feffffff2e9a616a0e6d1ff33f933a859a81048bbfcff00f982de4f950346a38a719ed1a5a4a1600410000004d4901040000000014e473f4c21fea82454eb89b698ba84c2ae3d068a8140b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a5379547f7701207f01207f7701247f537f77820134947f587f547f7701207f75597a5a796e7c828c7f755c7aa87bbbad060400000000145a7a7e5379011a7f777e587a8101117a635979a9597988029600b2757603e09304967802307597a269675f79009c635979a95b795d797e5e797ea9597988765c7987785e79879b785f79879b697803e09304965279023075979f63022c01b2756875675d79547f7701257f75a914282711cb97968c8674a46b5564ce3549f5782ea487916955795e79aa7e5f797eaa5779885d7960797f7701247f7556798860796376023075937767768b7768547854807e5579557f777e7b757c6853798102b80b945880760317a9147e5379a97e01877e76aa5579886d686d6d6d6d6d6d6d6d7551>"
    },
    {
      "outpointIndex": 0,
      "outpointTransactionHash": "<Uint8Array: 0x12e0043a4157c25014b058cd738b01684166d4d8156cbdb4647ef962fc6ddae9>",
      "sequenceNumber": 4294967294,
      "unlockingBytecode": "<Uint8Array: 0x41fe2875ffcb8c8c0eac88365fa8508e1230b9a5fa554e9be281866de7330eafd94aa404d2732b12dd7460f4d24d8d924ea3decb5d5209da07605fec8cb49964b2412103bf09ffac54d36172478e515e51c50df133e42d4879361f91574b36163a71d0ec>"
    }
  ],
  "locktime": 1460826,
  "outputs": [
    {
      "lockingBytecode": "<Uint8Array: 0xa914cfda703d91dd7aad90fc694951e7ac28eab3c42887>",
      "satoshis": "<Uint8Array: 0xb036000000000000>"
    }
  ],
  "version": 2,
  "txid": "e01bba67a1274c028b2926481a2bacbbf1d147032f334b30731629fd71ddac1b",
  "hex": "0200000002e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000fd1e05005102da0004000000004d2201020000000133c2629f613d22f0d6549f369560e148df6e1af5474501163635e7303a55c952010000007e41724009d0dd3d502def7e346eff213a0be2a89acd9740cc11535d813626b081e6bf431fa7a2d2b0aa7735858577702168593940bef4ad4b975e3673a304bc4a2841210380690473f0f8dcd6f3196e044d4fc160c44597315ccd6a42117f1d6f56cc960819143ed2b14d2418fdf1b384abbf9bbe4a9b9524ca6178a988acfeffffff03e8030000000000001976a9144eb0274c7dd98116b006afa00593bf236e37d23f88ac0000000000000000266a24e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000e21c27040000000017a91483eb112ad5945d4463cd4a8cd4881fcad8478c7e875a4a1600145c033dea9bfe166b6d12dff978ef3681d90d051714b43abfe1807134ff03c2ee9a70153fd9b7a187f7141adb432851cee81f2be81c0d6f4d8a3adb097a8a14e473f4c21fea82454eb89b698ba84c2ae3d068a82103bf09ffac54d36172478e515e51c50df133e42d4879361f91574b36163a71d0ec41b996b989403c2d12a8fff44dd0d9f6d041225e8c84d9ed5db0d170029ed0b8ce9b11c2a997abeaad0ce517cb0cb59195073e64999557be4766e2b35cdf07c490414de80102000000ab6d4b4c6a52752e26e4a8c53bf31d5f98a7ec04c9859d7a6c9a6cbd1166e11ac992651ac89a97aecd0811c1761915a8e2c8f5153d1bdd994a789e6bd86ab717e333ec7685c79dac37aa201a4aa75a1d08b3525287f5a1a809023c54b61328e000000000fd4901040000000014e473f4c21fea82454eb89b698ba84c2ae3d068a8140b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a5379547f7701207f01207f7701247f537f77820134947f587f547f7701207f75597a5a796e7c828c7f755c7aa87bbbad060400000000145a7a7e5379011a7f777e587a8101117a635979a9597988029600b2757603e09304967802307597a269675f79009c635979a95b795d797e5e797ea9597988765c7987785e79879b785f79879b697803e09304965279023075979f63022c01b2756875675d79547f7701257f75a914282711cb97968c8674a46b5564ce3549f5782ea487916955795e79aa7e5f797eaa5779885d7960797f7701247f7556798860796376023075937767768b7768547854807e5579557f777e7b757c6853798102b80b945880760317a9147e5379a97e01877e76aa5579886d686d6d6d6d6d6d6d6d75516842000000000000feffffff2e9a616a0e6d1ff33f933a859a81048bbfcff00f982de4f950346a38a719ed1a5a4a1600410000004d4901040000000014e473f4c21fea82454eb89b698ba84c2ae3d068a8140b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a5379547f7701207f01207f7701247f537f77820134947f587f547f7701207f75597a5a796e7c828c7f755c7aa87bbbad060400000000145a7a7e5379011a7f777e587a8101117a635979a9597988029600b2757603e09304967802307597a269675f79009c635979a95b795d797e5e797ea9597988765c7987785e79879b785f79879b697803e09304965279023075979f63022c01b2756875675d79547f7701257f75a914282711cb97968c8674a46b5564ce3549f5782ea487916955795e79aa7e5f797eaa5779885d7960797f7701247f7556798860796376023075937767768b7768547854807e5579557f777e7b757c6853798102b80b945880760317a9147e5379a97e01877e76aa5579886d686d6d6d6d6d6d6d6d7551feffffffe9da6dfc62f97e64b4bd6c15d8d4664168018b73cd58b01450c257413a04e012000000006441fe2875ffcb8c8c0eac88365fa8508e1230b9a5fa554e9be281866de7330eafd94aa404d2732b12dd7460f4d24d8d924ea3decb5d5209da07605fec8cb49964b2412103bf09ffac54d36172478e515e51c50df133e42d4879361f91574b36163a71d0ecfeffffff01b03600000000000017a914cfda703d91dd7aad90fc694951e7ac28eab3c428875a4a1600"
}
```

Now, the value (minus tx gas fee, which is 3000) is in new UTXO:

```bash
$ ts-node cc_covenant_v1_testnet.ts printCCVoteInfo alice 1 0

>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: e473f4c21fea82454eb89b698ba84c2ae3d068a8
2) yesNoBytes : 30750000
contract address: bchtest:pr8a5upaj8wh4tvsl355j5084s5w4v7y9q20qacpwm
contract balance: 14000
contract UTXOs  : [
  {
    txid: 'e01bba67a1274c028b2926481a2bacbbf1d147032f334b30731629fd71ddac1b',
    vout: 0,
    satoshis: 14000,
    height: 1460827
  }
]
```



## Step#5: finish unlock

Wait 2 blocks, and Alice can get her BCH:

```bash
$ ts-node cc_covenant_v1_testnet.ts finishUnlock alice 1 0 \
	e01bba67a1274c028b2926481a2bacbbf1d147032f334b30731629fd71ddac1b:0

> e01bba67a1274c028b2926481a2bacbbf1d147032f334b30731629fd71ddac1b:0
>> init cc_covenant, args:
0) opAddrsHash: 0b7e1c5142d4b6f910bc371122e86fdf2e7d3f9a
1) receiverPkh: e473f4c21fea82454eb89b698ba84c2ae3d068a8
2) yesNoBytes : 30750000
fromContract address: bchtest:pr8a5upaj8wh4tvsl355j5084s5w4v7y9q20qacpwm
fromContract UTXOs  : [
  {
    txid: 'e01bba67a1274c028b2926481a2bacbbf1d147032f334b30731629fd71ddac1b',
    vout: 0,
    satoshis: 14000,
    height: 1460827
  }
]
...
```







